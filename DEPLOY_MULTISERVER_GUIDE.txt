==================================================
    WOS Refill Bot - Multi-Server Configuration
==================================================

ğŸ“‹ æ¦‚è¿°
--------------------------------------------------
æœ¬ç³»çµ±ç¾å·²æ”¯æ´å¤šä¼ºæœå™¨ç¨ç«‹é‹è¡Œæ¶æ§‹ï¼Œæ¯å€‹èªè¨€ç‰ˆæœ¬å¯åœ¨å„è‡ªçš„ Discord ä¼ºæœå™¨ä¸Šé‹è¡Œè€Œä¸äº’ç›¸å¹²æ“¾ã€‚

ğŸ”§ æ¶æ§‹ç‰¹é»
--------------------------------------------------
âœ… ç™½åå–®æ©Ÿåˆ¶ (GUILD_ALLOWLIST)ï¼šåªæœå‹™æŒ‡å®šçš„ä¼ºæœå™¨
âœ… å‹•æ…‹è§’è‰²æª¢æŸ¥ï¼šæ¯å€‹ä¼ºæœå™¨å¯è¨­å®šä¸åŒçš„æ¬Šé™è§’è‰² ID
âœ… ç¨ç«‹é »é“é…ç½®ï¼šå„ä¼ºæœå™¨çš„ /refill å¡ç‰‡å¯é¡¯ç¤ºåœ¨ä¸åŒé »é“
âœ… å®¢è£½åŒ–é¢æ¿ç¶²å€ï¼šä¸­è‹±æ–‡ç‰ˆå¯ä½¿ç”¨ä¸åŒçš„ Web é¢æ¿è·¯å¾‘
âœ… ç®¡ç†å“¡è±å…ï¼šæ“æœ‰ Administrator æ¬Šé™è€…è‡ªå‹•é€šéæ¬Šé™æª¢æŸ¥

ğŸ“ æ ¸å¿ƒæª”æ¡ˆèªªæ˜
--------------------------------------------------
1. utils/config.py
   - çµ±ä¸€è¨­å®šç®¡ç†æ¨¡çµ„
   - å¾ .env è®€å–ä¸¦è§£æä¼ºæœå™¨å°æ‡‰é—œä¿‚
   - æä¾› GUILD_ALLOWLIST, COUNTER_ROLE_IDS, TARGET_TEXT_CHANNEL_IDS ç­‰è¨­å®š

2. cogs/counter.py
   - /counter æŒ‡ä»¤èˆ‡ Start/Stop æŒ‰éˆ•
   - æª¢æŸ¥ä¼ºæœå™¨ç™½åå–®
   - å‹•æ…‹è®€å–è©²ä¼ºæœå™¨çš„è§’è‰² ID æˆ–ä»¥åç¨±æœå°‹

3. cogs/refill.py
   - /refill æŒ‡ä»¤èˆ‡è¨ˆæ™‚å™¨å¡ç‰‡ç®¡ç†
   - æ ¹æ“š TARGET_TEXT_CHANNEL_IDS æ±ºå®šå¡ç‰‡é¡¯ç¤ºä½ç½®
   - å‹•æ…‹æ¬Šé™æª¢æŸ¥

4. bot_refill.py
   - ä¸»ç¨‹å¼å…¥å£
   - åªå°ç™½åå–®å…§çš„ä¼ºæœå™¨åŸ·è¡Œ slash command sync

ğŸš€ éƒ¨ç½²æ­¥é©Ÿï¼ˆè‹±æ–‡ç‰ˆç¯„ä¾‹ï¼‰
--------------------------------------------------

æ­¥é©Ÿ 1ï¼šä¸Šå‚³ä¸¦è§£å£“ç¸®
------------------------
unzip -o wos_refill_bot_URL_UPDATE_FINAL.zip
cd wos_english_count_bot

æ­¥é©Ÿ 2ï¼šè¨­å®š .env
------------------------
cp .env.example .env
nano .env

# å¡«å…¥ä»¥ä¸‹è³‡è¨Šï¼š
DISCORD_TOKEN=<ä½ çš„è‹±æ–‡ç‰ˆ Discord Bot Token>
GUILD_ALLOWLIST=1398071974692913324
COUNTER_ROLE_IDS=
COUNTER_ROLE_NAME=Annaway_Counter
TARGET_TEXT_CHANNEL_IDS=1398071974692913324:<ä½ çš„é »é“ID>
PANEL_URL=https://tools.annaway.com.tw/wos/counter-bot/1458/
PORT=8001

# æŒ‰ Ctrl+O å­˜æª”ï¼ŒEnter ç¢ºèªï¼ŒCtrl+X é›¢é–‹

æ­¥é©Ÿ 3ï¼šéƒ¨ç½²å‰ç«¯
------------------------
cd panel/frontend

# æ¸…ç†èˆŠæª”æ¡ˆï¼ˆå¦‚æœæœ‰æ¬Šé™å•é¡Œï¼‰
sudo rm -rf node_modules package-lock.json
npm cache clean --force

# å®‰è£ä¾è³´ä¸¦å»ºç½®
npm install
npm run build

# ç¢ºèªå»ºç½®æˆåŠŸ
ls -la dist/

# éƒ¨ç½²åˆ° Nginx
cd ~/wos_english_count_bot
sudo rm -rf /var/www/refill-bot-en/*
sudo cp -r panel/frontend/dist/* /var/www/refill-bot-en/

æ­¥é©Ÿ 4ï¼šæ›´æ–° Nginx è¨­å®š
------------------------
# ç·¨è¼¯ Nginx è¨­å®šæª”
sudo nano /etc/nginx/sites-available/refill-bot

# ç¢ºä¿æœ‰ä»¥ä¸‹å…§å®¹ï¼š
location /wos/counter-bot/1458/ {
    alias /var/www/refill-bot-en/;
    try_files $uri $uri/ /index.html;
    index index.html;
}

location /wos/counter-bot/1458/api/ {
    proxy_pass http://127.0.0.1:8001/api/;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
}

location /wos/counter-bot/1458/ws {
    proxy_pass http://127.0.0.1:8001/ws;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
}

# æ¸¬è©¦ä¸¦é‡å•Ÿ Nginx
sudo nginx -t
sudo systemctl restart nginx

æ­¥é©Ÿ 5ï¼šé‡å•Ÿ Bot æœå‹™
------------------------
sudo systemctl restart refill-bot-en

# ç­‰å¾…æœå‹™å•Ÿå‹•
sleep 5

# æŸ¥çœ‹æ—¥èªŒç¢ºèª
sudo journalctl -u refill-bot-en -n 30 --no-pager

# æ‡‰è©²çœ‹åˆ°ï¼š
# âœ… Bot logged in as ...
# âœ… Synced X slash commands globally
# âœ… Synced X slash commands for guild ...

ğŸ“ ä¸­æ–‡ç‰ˆéƒ¨ç½²ï¼ˆåƒè€ƒï¼‰
--------------------------------------------------
å¦‚æœæ‚¨è¦éƒ¨ç½²ä¸­æ–‡ç‰ˆï¼Œä½¿ç”¨ç›¸åŒçš„æ­¥é©Ÿï¼Œä½† .env è¨­å®šæ”¹ç‚ºï¼š

DISCORD_TOKEN=<ä¸­æ–‡ç‰ˆ Token>
GUILD_ALLOWLIST=1354505516193419454
TARGET_TEXT_CHANNEL_IDS=1354505516193419454:<ä¸­æ–‡ç‰ˆé »é“ID>
PANEL_URL=https://tools.annaway.com.tw/wos/counter-bot/1496/
PORT=8000

å‰ç«¯ä¹Ÿéœ€è¦ä¿®æ”¹ vite.config.ts çš„ base ç‚º '/wos/counter-bot/1496/'

ğŸ” é©—è­‰æ¸…å–®
--------------------------------------------------
âœ… è¨ªå• Web é¢æ¿ï¼šhttps://tools.annaway.com.tw/wos/counter-bot/1458/
âœ… åŸ·è¡Œ /counter æŒ‡ä»¤ï¼šæ‡‰è©²èƒ½çœ‹åˆ°æ“ä½œé¢æ¿
âœ… åŸ·è¡Œ /refill æŒ‡ä»¤ï¼šæ‡‰è©²é¡¯ç¤º Web é¢æ¿é€£çµ
âœ… æ¸¬è©¦ Start/Stop æŒ‰éˆ•ï¼šç¢ºèªæ¬Šé™æª¢æŸ¥æ­£å¸¸
âœ… ç¢ºèªè¨ˆæ™‚å™¨å¡ç‰‡å‡ºç¾åœ¨æ­£ç¢ºé »é“

âš ï¸ å¸¸è¦‹å•é¡Œ
--------------------------------------------------
Q: Slash commands çœ‹ä¸åˆ°ï¼Ÿ
A: 1. ç¢ºèª GUILD_ALLOWLIST è¨­å®šæ­£ç¢º
   2. åœ¨ Discord Developer Portal é‡æ–°æˆæ¬Šæ©Ÿå™¨äºº
   3. ç¢ºä¿å‹¾é¸ applications.commands æ¬Šé™

Q: æ¬Šé™éŒ¯èª¤ "Required role not found"ï¼Ÿ
A: 1. ç¢ºèªä¼ºæœå™¨ä¸­æœ‰ "Annaway_Counter" è§’è‰²
   2. æˆ–åœ¨ COUNTER_ROLE_IDS è¨­å®šè©²ä¼ºæœå™¨çš„è§’è‰² ID

Q: Web é¢æ¿ 403 éŒ¯èª¤ï¼Ÿ
A: 1. ç¢ºèª /var/www/refill-bot-en/ æœ‰æª”æ¡ˆ
   2. æª¢æŸ¥ Nginx è¨­å®šä¸­çš„ alias è·¯å¾‘
   3. åŸ·è¡Œ sudo systemctl restart nginx

Q: ä¸­è‹±æ–‡è¨ˆæ™‚å™¨æ··åœ¨ä¸€èµ·ï¼Ÿ
A: ç¢ºä¿å…©å€‹ç‰ˆæœ¬ä½¿ç”¨ **ä¸åŒçš„ Discord Token**
   é€™æ˜¯æœ€é‡è¦çš„éš”é›¢æ©Ÿåˆ¶ï¼

ğŸ“ æŠ€è¡“æ”¯æ´
--------------------------------------------------
é‡åˆ°å•é¡Œè«‹æä¾›ï¼š
1. sudo journalctl -u refill-bot-en -n 50 --no-pager
2. sudo nginx -t çš„è¼¸å‡º
3. .env æª”æ¡ˆå…§å®¹ï¼ˆéš±è— Tokenï¼‰

