==================================================
    å°ˆæ¡ˆç¶­è­·èˆ‡æ›´æ–°æŒ‡å—
==================================================

ğŸ“š æœ¬æŒ‡å—èªªæ˜å¦‚ä½•ç¶­è­·ã€æ›´æ–°èˆ‡éƒ¨ç½² WOS Refill Bot å°ˆæ¡ˆ

==================================================
1. Git åŸºæœ¬æ“ä½œ
==================================================

1.1 å¾ GitHub æ‹‰å–æœ€æ–°ç¨‹å¼ç¢¼
--------------------------------------------------
# åœ¨æœ¬æ©Ÿæˆ–ä¼ºæœå™¨é€²å…¥å°ˆæ¡ˆç›®éŒ„
cd annaway-wos-counter-bot  # æˆ– wos-english-refill-bot

# æ‹‰å–æœ€æ–°ç¨‹å¼ç¢¼
git pull origin main

1.2 å°‡æ”¹å‹•æ¨å› GitHub
--------------------------------------------------
# æŸ¥çœ‹ä¿®æ”¹ç‹€æ…‹
git status

# åŠ å…¥æ‰€æœ‰ä¿®æ”¹çš„æª”æ¡ˆ
git add .

# æˆ–åªåŠ å…¥ç‰¹å®šæª”æ¡ˆ
git add utils/config.py utils/audio_player.py

# æäº¤è®Šæ›´ï¼ˆè«‹ç”¨æœ‰æ„ç¾©çš„èªªæ˜ï¼‰
git commit -m "æè¿°ä¿®æ”¹å…§å®¹"

# æ¨é€åˆ° GitHub
git push origin main

==================================================
2. èªéŸ³æª”æ¡ˆç®¡ç† (AUDIO_DIR)
==================================================

2.1 èªéŸ³è³‡æ–™å¤¾çµæ§‹
--------------------------------------------------
å°ˆæ¡ˆæ ¹ç›®éŒ„/
â”œâ”€â”€ assets/
â”‚   â”œâ”€â”€ audio/          # ä¸­æ–‡ç‰ˆèªéŸ³æª”
â”‚   â”‚   â”œâ”€â”€ 0.wav
â”‚   â”‚   â”œâ”€â”€ 1p.wav
â”‚   â”‚   â”œâ”€â”€ 2p.wav
â”‚   â”‚   â””â”€â”€ ... (è‡³ 100p.wav)
â”‚   â””â”€â”€ audio_en/       # è‹±æ–‡ç‰ˆèªéŸ³æª”
â”‚       â”œâ”€â”€ 0.mp3
â”‚       â”œâ”€â”€ 1p.mp3
â”‚       â”œâ”€â”€ 2p.mp3
â”‚       â””â”€â”€ ... (è‡³ 100p.mp3)

2.2 è¨­å®šèªéŸ³è³‡æ–™å¤¾ (.env)
--------------------------------------------------
# è‹±æ–‡ç‰ˆ .env
AUDIO_DIR=assets/audio_en

# ä¸­æ–‡ç‰ˆ .env
AUDIO_DIR=assets/audio

2.3 ç”Ÿæˆè‹±æ–‡èªéŸ³æª”
--------------------------------------------------
# ç¢ºä¿å·²å®‰è£ gTTS
pip3 install gtts

# ç”Ÿæˆè‹±æ–‡èªéŸ³æª”åˆ° assets/audio_en
python3 tools/generate_audio.py

# æª¢æŸ¥æª”æ¡ˆæ˜¯å¦ç”Ÿæˆ
ls -la assets/audio_en/

==================================================
3. é »é“è¨­å®š (TARGET_TEXT_CHANNEL_IDS)
==================================================

3.1 è¨­å®šæ ¼å¼
--------------------------------------------------
# æ ¼å¼ï¼šguild_id:channel_id,guild_id2:channel_id2

# å–®ä¸€ä¼ºæœå™¨ç¯„ä¾‹ï¼ˆè‹±æ–‡ç‰ˆï¼‰
TARGET_TEXT_CHANNEL_IDS=1398071974692913324:1398071975460733043

# å¤šä¼ºæœå™¨ç¯„ä¾‹
TARGET_TEXT_CHANNEL_IDS=1398071974692913324:1398071975460733043,1354505516193419454:1354505516730757180

3.2 å¦‚ä½•å–å¾—é »é“ ID
--------------------------------------------------
1. åœ¨ Discord å•Ÿç”¨é–‹ç™¼è€…æ¨¡å¼ï¼š
   è¨­å®š â†’ é€²éš â†’ é–‹ç™¼è€…æ¨¡å¼ â†’ é–‹å•Ÿ

2. å³éµé»æ“Šé »é“ â†’ è¤‡è£½ ID

3. å°‡ ID å¡«å…¥ .env çš„ TARGET_TEXT_CHANNEL_IDS

==================================================
4. å®Œæ•´éƒ¨ç½²æµç¨‹
==================================================

4.1 æœ¬åœ°ä¿®æ”¹ç¨‹å¼ç¢¼
--------------------------------------------------
# 1. ä¿®æ”¹ç¨‹å¼ç¢¼ï¼ˆä¾‹å¦‚ï¼šutils/config.pyï¼‰

# 2. æ¸¬è©¦ä¿®æ”¹ï¼ˆå¯é¸ï¼‰
python3 bot_refill.py

# 3. æäº¤åˆ° Git
git add .
git commit -m "æ”¯æŒè‡ªè¨‚èªéŸ³è³‡æ–™å¤¾ã€ä¿®æ­£è‹±æ–‡ç‰ˆ refill é »é“è¨­å®š"
git push origin main

4.2 åœ¨ VM ä¸Šæ›´æ–°è‹±æ–‡ç‰ˆ
--------------------------------------------------
# é€£ç·šåˆ° VM
ssh anna_c@your-vm-ip

# é€²å…¥è‹±æ–‡ç‰ˆå°ˆæ¡ˆç›®éŒ„
cd ~/wos-english-refill-bot

# æ‹‰å–æœ€æ–°ç¨‹å¼ç¢¼
git pull origin main

# ç¢ºèª .env è¨­å®šæ­£ç¢º
nano .env
# ç¢ºä¿æœ‰ï¼š
# AUDIO_DIR=assets/audio_en
# TARGET_TEXT_CHANNEL_IDS=1398071974692913324:ä½ çš„é »é“ID

# å¦‚æœéœ€è¦é‡æ–°ç”Ÿæˆè‹±æ–‡èªéŸ³æª”
cd ~/wos-english-refill-bot
python3 tools/generate_audio.py

# é‡å•Ÿæœå‹™
sudo systemctl daemon-reload
sudo systemctl restart refill-bot-en

# æŸ¥çœ‹æ—¥èªŒ
sudo journalctl -u refill-bot-en -n 30 --no-pager

4.3 åœ¨ VM ä¸Šæ›´æ–°ä¸­æ–‡ç‰ˆ
--------------------------------------------------
# é€²å…¥ä¸­æ–‡ç‰ˆå°ˆæ¡ˆç›®éŒ„
cd ~/wos-chinese-refill-bot

# æ‹‰å–æœ€æ–°ç¨‹å¼ç¢¼
git pull origin main

# ç¢ºèª .env è¨­å®šæ­£ç¢º
nano .env
# ç¢ºä¿æœ‰ï¼š
# AUDIO_DIR=assets/audio
# TARGET_TEXT_CHANNEL_IDS=1354505516193419454:ä½ çš„é »é“ID

# é‡å•Ÿæœå‹™
sudo systemctl daemon-reload
sudo systemctl restart refill-bot-zh

# æŸ¥çœ‹æ—¥èªŒ
sudo journalctl -u refill-bot-zh -n 30 --no-pager

==================================================
5. å¸¸è¦‹ç¶­è­·ä»»å‹™
==================================================

5.1 æ›´æ–° Discord Token
--------------------------------------------------
# ç·¨è¼¯ .env
nano ~/wos-english-refill-bot/.env

# ä¿®æ”¹ DISCORD_TOKEN=æ–°çš„Token

# é‡å•Ÿæœå‹™
sudo systemctl restart refill-bot-en

5.2 è®Šæ›´ Web é¢æ¿ç¶²å€
--------------------------------------------------
# ç·¨è¼¯ .env
nano ~/wos-english-refill-bot/.env

# ä¿®æ”¹ PANEL_URL=https://tools.annaway.com.tw/wos/counter-bot/1458/

# é‡å•Ÿæœå‹™
sudo systemctl restart refill-bot-en

5.3 æ–°å¢æ”¯æ´çš„ä¼ºæœå™¨
--------------------------------------------------
# ç·¨è¼¯ .env
nano ~/wos-english-refill-bot/.env

# åœ¨ GUILD_ALLOWLIST åŠ å…¥æ–°çš„ guild IDï¼ˆç”¨é€—è™Ÿåˆ†éš”ï¼‰
GUILD_ALLOWLIST=1398071974692913324,æ–°çš„guild_id

# å¦‚æœæ–°ä¼ºæœå™¨éœ€è¦ä¸åŒçš„é »é“ï¼Œä¹Ÿæ›´æ–° TARGET_TEXT_CHANNEL_IDS
TARGET_TEXT_CHANNEL_IDS=1398071974692913324:é »é“1,æ–°çš„guild_id:é »é“2

# é‡å•Ÿæœå‹™
sudo systemctl restart refill-bot-en

5.4 æŸ¥çœ‹æœå‹™ç‹€æ…‹èˆ‡æ—¥èªŒ
--------------------------------------------------
# æŸ¥çœ‹æœå‹™ç‹€æ…‹
sudo systemctl status refill-bot-en
sudo systemctl status refill-bot-zh

# æŸ¥çœ‹å³æ™‚æ—¥èªŒ
sudo journalctl -u refill-bot-en -f

# æŸ¥çœ‹æœ€è¿‘ 50 è¡Œæ—¥èªŒ
sudo journalctl -u refill-bot-en -n 50 --no-pager

# æœå°‹ç‰¹å®šé—œéµå­—
sudo journalctl -u refill-bot-en | grep "Synced"

5.5 é‡å•Ÿæ‰€æœ‰æœå‹™
--------------------------------------------------
# é‡å•Ÿè‹±æ–‡ç‰ˆ
sudo systemctl restart refill-bot-en

# é‡å•Ÿä¸­æ–‡ç‰ˆ
sudo systemctl restart refill-bot-zh

# é‡å•Ÿ Nginx
sudo systemctl restart nginx

# æª¢æŸ¥æ‰€æœ‰ refill-bot æœå‹™
sudo systemctl status refill-bot-*

==================================================
6. æ•…éšœæ’é™¤
==================================================

6.1 Slash Commands æ²’æœ‰å‡ºç¾
--------------------------------------------------
å•é¡Œï¼šåœ¨ Discord è¼¸å…¥ / çœ‹ä¸åˆ°æŒ‡ä»¤

è§£æ±ºæ–¹æ³•ï¼š
1. æª¢æŸ¥æ—¥èªŒæ˜¯å¦æœ‰ "Synced X slash commands"
   sudo journalctl -u refill-bot-en | grep "Synced"

2. ç¢ºèª .env çš„ GUILD_ALLOWLIST æ­£ç¢º
   cat ~/wos-english-refill-bot/.env | grep GUILD_ALLOWLIST

3. åœ¨ Discord Developer Portal é‡æ–°æˆæ¬Š Bot
   - ç¢ºä¿å‹¾é¸ applications.commands
   - é‡æ–°ç”Ÿæˆé‚€è«‹é€£çµä¸¦æˆæ¬Š

4. é‡å•Ÿæœå‹™
   sudo systemctl restart refill-bot-en

6.2 èªéŸ³ç„¡æ³•æ’­æ”¾
--------------------------------------------------
å•é¡Œï¼š/counter æŒ‡ä»¤ç„¡èªéŸ³

è§£æ±ºæ–¹æ³•ï¼š
1. æª¢æŸ¥ AUDIO_DIR è¨­å®š
   cat ~/wos-english-refill-bot/.env | grep AUDIO_DIR

2. ç¢ºèªèªéŸ³æª”æ¡ˆå­˜åœ¨
   ls -la ~/wos-english-refill-bot/assets/audio_en/

3. æª¢æŸ¥ FFmpeg æ˜¯å¦å®‰è£
   which ffmpeg

4. é‡æ–°ç”ŸæˆèªéŸ³æª”
   cd ~/wos-english-refill-bot
   python3 tools/generate_audio.py

6.3 Refill å¡ç‰‡æ²’æœ‰å‡ºç¾
--------------------------------------------------
å•é¡Œï¼šåŸ·è¡Œ /refill å¾Œæ²’æœ‰çœ‹åˆ°å¡ç‰‡

è§£æ±ºæ–¹æ³•ï¼š
1. æª¢æŸ¥ TARGET_TEXT_CHANNEL_IDS è¨­å®š
   cat ~/wos-english-refill-bot/.env | grep TARGET_TEXT_CHANNEL_IDS

2. ç¢ºèªæ ¼å¼æ­£ç¢ºï¼ˆguild_id:channel_idï¼‰
   TARGET_TEXT_CHANNEL_IDS=1398071974692913324:1398071975460733043

3. ç¢ºèª Bot æœ‰è©²é »é“çš„ç™¼é€è¨Šæ¯æ¬Šé™

4. æŸ¥çœ‹æ—¥èªŒç¢ºèªéŒ¯èª¤
   sudo journalctl -u refill-bot-en -n 50

6.4 Port è¢«ä½”ç”¨
--------------------------------------------------
å•é¡Œï¼šæœå‹™ç„¡æ³•å•Ÿå‹•ï¼Œæç¤º port already in use

è§£æ±ºæ–¹æ³•ï¼š
# æŸ¥çœ‹èª°ä½”ç”¨äº† port
sudo netstat -tlnp | grep 8001

# çµ‚æ­¢ä½”ç”¨çš„ç¨‹åº
sudo kill -9 <PID>

# æˆ–å¼·åˆ¶çµ‚æ­¢æ‰€æœ‰ bot_refill.py
pkill -f bot_refill.py

# é‡å•Ÿæœå‹™
sudo systemctl restart refill-bot-en

6.5 ä¸­è‹±æ–‡è¨ˆæ™‚å™¨æ··åœ¨ä¸€èµ·
--------------------------------------------------
å•é¡Œï¼šå…©å€‹ç‰ˆæœ¬çš„è¨ˆæ™‚å™¨å‡ºç¾åœ¨éŒ¯èª¤çš„é »é“

è§£æ±ºæ–¹æ³•ï¼š
1. ç¢ºèªä½¿ç”¨ä¸åŒçš„ Discord Token
   - è‹±æ–‡ç‰ˆå’Œä¸­æ–‡ç‰ˆå¿…é ˆæ˜¯ä¸åŒçš„ Bot

2. ç¢ºèª TARGET_TEXT_CHANNEL_IDS ä¸åŒ
   - è‹±æ–‡ç‰ˆï¼šæŒ‡å‘è‹±æ–‡ä¼ºæœå™¨çš„é »é“
   - ä¸­æ–‡ç‰ˆï¼šæŒ‡å‘ä¸­æ–‡ä¼ºæœå™¨çš„é »é“

3. æª¢æŸ¥ GUILD_ALLOWLIST åªåŒ…å«å°æ‡‰çš„ä¼ºæœå™¨
   - è‹±æ–‡ç‰ˆï¼šGUILD_ALLOWLIST=1398071974692913324
   - ä¸­æ–‡ç‰ˆï¼šGUILD_ALLOWLIST=1354505516193419454

==================================================
7. ç‰ˆæœ¬å·®ç•°å°ç…§è¡¨
==================================================

| é …ç›® | è‹±æ–‡ç‰ˆ | ä¸­æ–‡ç‰ˆ |
|------|--------|--------|
| è³‡æ–™å¤¾ | ~/wos-english-refill-bot | ~/wos-chinese-refill-bot |
| æœå‹™åç¨± | refill-bot-en.service | refill-bot-zh.service |
| Port | 8001 | 8000 |
| Web è·¯å¾‘ | /wos/counter-bot/1458/ | /wos/counter-bot/1496/ |
| Nginx ç›®éŒ„ | /var/www/refill-bot-en/ | /var/www/refill-bot/ |
| AUDIO_DIR | assets/audio_en | assets/audio |
| Guild ID | 1398071974692913324 | 1354505516193419454 |

==================================================
8. å¿«é€Ÿåƒè€ƒæŒ‡ä»¤
==================================================

# Git æ“ä½œ
git pull origin main              # æ‹‰å–æœ€æ–°ç¨‹å¼ç¢¼
git add .                         # åŠ å…¥æ‰€æœ‰è®Šæ›´
git commit -m "æè¿°"              # æäº¤è®Šæ›´
git push origin main              # æ¨é€åˆ° GitHub

# æœå‹™ç®¡ç†
sudo systemctl restart refill-bot-en    # é‡å•Ÿè‹±æ–‡ç‰ˆ
sudo systemctl status refill-bot-en     # æŸ¥çœ‹ç‹€æ…‹
sudo journalctl -u refill-bot-en -f     # å³æ™‚æ—¥èªŒ

# ç’°å¢ƒè¨­å®š
nano ~/wos-english-refill-bot/.env      # ç·¨è¼¯è¨­å®š
cat .env | grep AUDIO_DIR                # æŸ¥çœ‹ç‰¹å®šè¨­å®š

# èªéŸ³æª”æ¡ˆ
python3 tools/generate_audio.py          # ç”ŸæˆèªéŸ³
ls -la assets/audio_en/                  # åˆ—å‡ºèªéŸ³æª”

# Nginx
sudo nginx -t                            # æ¸¬è©¦è¨­å®š
sudo systemctl restart nginx             # é‡å•Ÿ Nginx

