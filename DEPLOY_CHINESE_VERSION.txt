==================================================
    ä¸­æ–‡ç‰ˆéƒ¨ç½²å®Œæ•´æŒ‡å—
==================================================

ğŸ“‹ å‰ææ¢ä»¶
--------------------------------------------------
1. å·²ç¶“éƒ¨ç½²å¥½è‹±æ–‡ç‰ˆï¼ˆä½¿ç”¨ wos_refill_bot_MULTISERVER_FINAL.zipï¼‰
2. æ“æœ‰ç¨ç«‹çš„ä¸­æ–‡ç‰ˆ Discord Bot Token
3. ä¸­æ–‡ç‰ˆä¼ºæœå™¨ ID: 1354505516193419454

ğŸ”§ æ­¥é©Ÿ 1ï¼šä¿®æ”¹å‰ç«¯è·¯å¾‘ç‚º 1496
--------------------------------------------------
ä¸­æ–‡ç‰ˆéœ€è¦ä¿®æ”¹å‰ç«¯çš„ base pathã€‚

# åœ¨æœ¬åœ°é›»è…¦æ“ä½œï¼ˆä¿®æ”¹å°ˆæ¡ˆï¼‰
cd F:\AnnawayProjects\wos_english_count_bot

# ç·¨è¼¯ vite.config.ts
nano panel/frontend/vite.config.ts

# å°‡ base æ”¹ç‚ºï¼š
base: '/wos/counter-bot/1496/',

# åŒæ™‚ç¢ºèª proxy æŒ‡å‘ port 8000ï¼š
proxy: {
  '/api': {
    target: 'http://localhost:8000',  # ä¸­æ–‡ç‰ˆç”¨ 8000
    changeOrigin: true
  },
  '/ws': {
    target: 'ws://localhost:8000',    # ä¸­æ–‡ç‰ˆç”¨ 8000
    ws: true,
    changeOrigin: true
  }
}

ğŸ“¦ æ­¥é©Ÿ 2ï¼šæ‰“åŒ…ä¸­æ–‡ç‰ˆ
--------------------------------------------------
# åœ¨æœ¬åœ°é›»è…¦æ“ä½œ
cd F:\AnnawayProjects\wos_english_count_bot
Compress-Archive -Path "." -DestinationPath "wos_refill_bot_CHINESE_1496.zip" -Force

ğŸš€ æ­¥é©Ÿ 3ï¼šéƒ¨ç½²åˆ° VM
--------------------------------------------------
# åœ¨ VM ä¸Šæ“ä½œ

# 1. ä¸Šå‚³ä¸¦è§£å£“ç¸®ä¸­æ–‡ç‰ˆ
cd ~
unzip -o wos_refill_bot_CHINESE_1496.zip -d wos-chinese-refill-bot
cd wos-chinese-refill-bot

# 2. å»ºç«‹ä¸­æ–‡ç‰ˆ .env
nano .env

# å¡«å…¥ä»¥ä¸‹å…§å®¹ï¼š
DISCORD_TOKEN=ä½ çš„ä¸­æ–‡ç‰ˆToken
GUILD_ALLOWLIST=1354505516193419454
COUNTER_ROLE_IDS=
COUNTER_ROLE_NAME=Annaway_Counter
TARGET_TEXT_CHANNEL_IDS=1354505516193419454:ä½ çš„ä¸­æ–‡é »é“ID
PANEL_URL=https://tools.annaway.com.tw/wos/counter-bot/1496/
PORT=8000

# Ctrl+O å­˜æª”, Enter ç¢ºèª, Ctrl+X é›¢é–‹

# 3. å®‰è£ Python ä¾è³´
pip3 install -r requirements_refill.txt

# 4. å»ºç½®å‰ç«¯
cd panel/frontend
sudo rm -rf node_modules package-lock.json
npm cache clean --force
npm install
npm run build

# ç¢ºèª dist è³‡æ–™å¤¾ç”Ÿæˆ
ls -la dist/

# 5. éƒ¨ç½²åˆ° Nginxï¼ˆä¸­æ–‡ç‰ˆç”¨ /var/www/refill-bot/ï¼‰
cd ~/wos-chinese-refill-bot
sudo rm -rf /var/www/refill-bot/*
sudo cp -r panel/frontend/dist/* /var/www/refill-bot/

# 6. ç¢ºèª Nginx è¨­å®šåŒ…å« 1496 è·¯å¾‘
sudo nano /etc/nginx/sites-available/refill-bot

# æ‡‰è©²è¦æœ‰ä»¥ä¸‹å€å¡Šï¼š
location /wos/counter-bot/1496/ {
    alias /var/www/refill-bot/;
    try_files $uri $uri/ /index.html;
    index index.html;
}

location /wos/counter-bot/1496/api/ {
    proxy_pass http://127.0.0.1:8000/api/;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
}

location /wos/counter-bot/1496/ws {
    proxy_pass http://127.0.0.1:8000/ws;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
}

# æ¸¬è©¦ä¸¦é‡å•Ÿ Nginx
sudo nginx -t
sudo systemctl restart nginx

# 7. å»ºç«‹ systemd æœå‹™ï¼ˆä¸­æ–‡ç‰ˆï¼‰
sudo nano /etc/systemd/system/refill-bot-zh.service

# å¡«å…¥ä»¥ä¸‹å…§å®¹ï¼š
[Unit]
Description=WOS Refill Timer Bot (Chinese Version)
After=network.target

[Service]
Type=simple
User=anna_c
WorkingDirectory=/home/anna_c/wos-chinese-refill-bot
ExecStart=/usr/bin/python3 bot_refill.py
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target

# Ctrl+O å­˜æª”, Enter ç¢ºèª, Ctrl+X é›¢é–‹

# 8. å•Ÿå‹•ä¸­æ–‡ç‰ˆæœå‹™
sudo systemctl daemon-reload
sudo systemctl enable refill-bot-zh
sudo systemctl start refill-bot-zh

# 9. æŸ¥çœ‹æœå‹™ç‹€æ…‹
sudo systemctl status refill-bot-zh
sudo journalctl -u refill-bot-zh -n 30 --no-pager

âœ… æ­¥é©Ÿ 4ï¼šé©—è­‰éƒ¨ç½²
--------------------------------------------------
# 1. æª¢æŸ¥å…©å€‹æœå‹™éƒ½åœ¨é‹è¡Œ
sudo systemctl status refill-bot-en  # è‹±æ–‡ç‰ˆ (port 8001)
sudo systemctl status refill-bot-zh  # ä¸­æ–‡ç‰ˆ (port 8000)

# 2. æ¸¬è©¦ Web é¢æ¿
# è‹±æ–‡ç‰ˆï¼šhttps://tools.annaway.com.tw/wos/counter-bot/1458/
# ä¸­æ–‡ç‰ˆï¼šhttps://tools.annaway.com.tw/wos/counter-bot/1496/

# 3. åœ¨ Discord æ¸¬è©¦æŒ‡ä»¤
# è‹±æ–‡ä¼ºæœå™¨ï¼š/counter, /refill
# ä¸­æ–‡ä¼ºæœå™¨ï¼š/counter, /refill

# 4. ç¢ºèªè¨ˆæ™‚å™¨ä¸æœƒæ··åœ¨ä¸€èµ·
# ä¸­è‹±æ–‡ç‰ˆæ‡‰è©²å„è‡ªåœ¨å„è‡ªçš„é »é“é¡¯ç¤º

ğŸ“Š æœå‹™ç®¡ç†æŒ‡ä»¤
--------------------------------------------------
# è‹±æ–‡ç‰ˆ
sudo systemctl restart refill-bot-en
sudo journalctl -u refill-bot-en -n 50 --no-pager

# ä¸­æ–‡ç‰ˆ
sudo systemctl restart refill-bot-zh
sudo journalctl -u refill-bot-zh -n 50 --no-pager

# åŒæ™‚æŸ¥çœ‹å…©å€‹æœå‹™
sudo systemctl status refill-bot-*

âš ï¸ é‡è¦æé†’
--------------------------------------------------
1. âœ… ä¸­è‹±æ–‡ç‰ˆå¿…é ˆä½¿ç”¨ä¸åŒçš„ Discord Bot Token
2. âœ… ä¸­æ–‡ç‰ˆ port 8000ï¼Œè‹±æ–‡ç‰ˆ port 8001
3. âœ… ä¸­æ–‡ç‰ˆè·¯å¾‘ /1496/ï¼Œè‹±æ–‡ç‰ˆè·¯å¾‘ /1458/
4. âœ… TARGET_TEXT_CHANNEL_IDS è¦å¡«å…¥å„è‡ªä¼ºæœå™¨çš„é »é“ ID
5. âœ… å…©å€‹ç‰ˆæœ¬çš„å°ˆæ¡ˆè³‡æ–™å¤¾è¦åˆ†é–‹ï¼ˆwos-chinese-refill-bot å’Œ wos-english-refill-botï¼‰

ğŸ”§ å¦‚æœé‡åˆ°å•é¡Œ
--------------------------------------------------
# æª¢æŸ¥ port æ˜¯å¦è¢«ä½”ç”¨
sudo netstat -tlnp | grep -E "8000|8001"

# æª¢æŸ¥ Nginx è¨­å®š
sudo nginx -t

# æŸ¥çœ‹å®Œæ•´æ—¥èªŒ
sudo journalctl -u refill-bot-zh -f  # å³æ™‚æŸ¥çœ‹ä¸­æ–‡ç‰ˆæ—¥èªŒ
sudo journalctl -u refill-bot-en -f  # å³æ™‚æŸ¥çœ‹è‹±æ–‡ç‰ˆæ—¥èªŒ

